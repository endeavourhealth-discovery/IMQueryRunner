import type { NitroApp } from "nitropack";
import { SDK } from "casdoor-nodejs-sdk";

export default defineNitroPlugin((nitroApp: NitroApp) => {
  const authConfig = {
    endpoint: process.env.NUXT_PUBLIC_CASDOOR_URL!,
    clientId: process.env.NUXT_PUBLIC_CASDOOR_CLIENT_ID!,
    clientSecret: process.env.NUXT_PUBLIC_CASDOOR_CLIENT_SECRET!,
    certificate: `-----BEGIN CERTIFICATE-----
MIIE3TCCAsWgAwIBAgIDAeJAMA0GCSqGSIb3DQEBCwUAMCgxDjAMBgNVBAoTBWFk
bWluMRYwFAYDVQQDEw1jZXJ0LWJ1aWx0LWluMB4XDTI1MDkwNDEzMDQxOFoXDTQ1
MDkwNDEzMDQxOFowKDEOMAwGA1UEChMFYWRtaW4xFjAUBgNVBAMTDWNlcnQtYnVp
bHQtaW4wggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCtqRqfNramWD2k
kwDO2PoR1/YspjRC4fkevN0+xsUH2doRrVaGYhGuYg/wa3MBz4dmg9n8YaYGbRez
7LtM9N9alwKGs2V1QDKfL+O+JOUAog9zxiCQC7NW3GOJ+DWqM81/bDI8LT0J1223
jT6Fx+Rc34A8C2cwLLqfNMhvLhJAKxt33K33I3wBPBTF49yi54e/zxrBo7KZ3jld
Vl0iEMP9Rm9SUQ5dAMKp/YHKPvhGrHOWtuI5FubJWJeJxLNer7hiPzVfuW7Jcxz8
VeJno0YBA8BVo7sEYjFZT6uApedpGpp1mezLEOWdCjA9HMSLTm/yBxlw6lOrew51
MweYVp+WRAOCvTYg8OEUGeQY+CwT1cjvrFLlyOqlGLlNax3pluHSfMgA7FGf1PEy
72b/gWDkCXjPaDk07KkVWD3Bj6FEoC1pwN38Sps2UFktpvVvNpeX0D4jbTLCLh1Q
cm02Q+pTcukTVuOPOUyC9d1l+lJNU6TzBI82iYF0zqxeJ3VoXmS0TdsYtsSKMH+M
Oo1GmO3NhbFvZW14c4SXWjZDJZpjEz/wyDz1J9mshx9mxTgujEm33awJY1EYY1us
oLvpVTUCJo298k1HToTfpjIH7QuFZK8vlAzMMBk9VxfgrEtlRieP5N52qKMnMq8T
V/OyAPmN4tKu14G2IWf0vp06Re7FawIDAQABoxAwDjAMBgNVHRMBAf8EAjAAMA0G
CSqGSIb3DQEBCwUAA4ICAQAp+VtbkOjQ98ILspGjgu9OxDnw5srkJiqg6SpiSqP5
3k7j2/WwC20+rBOWAQMT0AOjykZdq8gF4hiCHknbsljXV40TETL5tUf9Lp7kHTZL
H/6UGU04KaCjMl2rz6VTPy4UtMTDWiHG47lbERm2q50EGVXbx8HBbqNgv3pcCV4o
4CclDnFULfOxnweneSRFj4oJ9COh8AzV0iUtb5J/A8NM6kgR49yl0mrn3UvZzlwc
er5WSp/DFWbEF/Ydh6Pkc+ybUNs8hSeKPyty9EsZ/mbU4aZ/RtM9dHh2v6v+ai8K
6V/54Rc4vP4DnMP70HoQ+PsnkJpSc4MEv6OQGYt0H2JjejTXHQScaA1U7wG3Kn2n
90nPPAw5/+L9A83zzjPlkTvyOOok14eOjL77Nm+HpoPICOlBg6KytflcMX81Ty0y
SXpB+nHQkP8q2ndZ2FKHaITdAyXnFPZe7m1Fy8KpoMEWKGm7g9URoIMmMx7z8kTJ
TBvgGbR7fE0AIEprUyUkmccBdXYZvylG5rF2IhYTP4cCw4/7KNPInycJwDVplGQN
75nAfzuRZeH+P49M341XgQ0olSBmOaxNjM9gYPyCldYD+mzwquoNEciuKrDaYwQB
Gexg/izzlo75ambn9haORPatDFvohpododHubBlumJXgePnqHMe78fmR20oep8NS
9A==
-----END CERTIFICATE-----`,
    orgName: "Endeavour",
    appName: "QueryRunner",
  };
  const sdk = new SDK(authConfig);

  globalThis.casdoor = sdk;
});
